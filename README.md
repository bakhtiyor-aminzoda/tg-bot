# Telegram Video Downloader Bot (MVP)

–ë–æ—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ —Å YouTube –∏ TikTok –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram.
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è: Python + aiogram 3.x + yt-dlp.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```
project/
‚îÇ‚îÄ‚îÄ main.py
‚îÇ‚îÄ‚îÄ config.py
‚îÇ‚îÄ‚îÄ requirements.txt
‚îÇ‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ downloader.py
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ/—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç:
```bash
git clone <repo> && cd project
```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ:
```bash
python3 -m venv venv
source venv/bin/activate    # Linux / macOS
# venv\Scripts\activate     # Windows (PowerShell: .\venv\Scripts\Activate.ps1)
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `yt-dlp` (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ). –ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ —Å—Ç–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ venv:
```bash
pip install yt-dlp
```
> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `yt-dlp` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ PATH (–∏–∑ —Ç–æ–≥–æ –∂–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –≥–¥–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –±–æ—Ç–∞).

5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `.env` (–æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã):
```bash
cp .env.example .env
echo "TELEGRAM_BOT_TOKEN=123456:ABCDEF..." >> .env
echo "DATABASE_URL=sqlite:///./data/history.db" >> .env
```
–§–∞–π–ª –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ—á–∏—Ç–∞–Ω –±–ª–∞–≥–æ–¥–∞—Ä—è `python-dotenv`. –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏ –ø—Ä—è–º–æ–µ
`export TELEGRAM_BOT_TOKEN=...` –∏ `export DATABASE_URL=...` (Windows: `setx TELEGRAM_BOT_TOKEN ...`). –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ git.

6. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
python main.py
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (Alembic)

–°—Ö–µ–º–∞ –±–∞–∑—ã –≤–µ—Ä—Å–∏–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Alembic (–∫–∞—Ç–∞–ª–æ–≥ `alembic/`).

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω—ã:
  ```bash
  export TELEGRAM_BOT_TOKEN=123456:ABCDEF
  export DATABASE_URL=postgresql+psycopg://user:pass@host/dbname
  ```
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
  ```bash
  ALEMBIC_DATABASE_URL="$DATABASE_URL" alembic upgrade head
  ```
3. –ß—Ç–æ–±—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
  ```bash
  alembic revision --autogenerate -m "add new table"
  ALEMBIC_DATABASE_URL="$DATABASE_URL" alembic upgrade head
  ```

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite –º–æ–∂–Ω–æ –æ–ø—É—Å—Ç–∏—Ç—å `ALEMBIC_DATABASE_URL` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `alembic.ini`).

## –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
make check   # Ruff lint (E/F/W/B/I/UP/N rules)
make fmt     # Ruff formatter (–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã)
make test    # python -m unittest discover
```
–ö–æ–º–∞–Ω–¥—ã –æ–ø–∏—Ä–∞—é—Ç—Å—è –Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `ruff` (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ CI –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å
—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ `pip install ruff`).

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

- **–õ–æ–∫–∞–ª—å–Ω–æ:** –∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω `cp .env.example .env`, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `TELEGRAM_BOT_TOKEN` –∏ –¥—Ä—É–≥–∏–µ
  –∑–Ω–∞—á–µ–Ω–∏—è. –§–∞–π–ª `.env` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.gitignore`, –ø–æ—ç—Ç–æ–º—É —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ git.
- **Docker / docker-compose:** —Ç–æ—Ç –∂–µ `.env` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å
  –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `docker run -e ...`.
- **CI / GitHub Actions:** —Ö—Ä–∞–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `Repository Settings ‚Üí Secrets and variables ‚Üí Actions`
  (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TELEGRAM_BOT_TOKEN`, `SENTRY_DSN`). Workflow –±–µ—Ä—ë—Ç —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
  –æ–∫—Ä—É–∂–µ–Ω–∏—è, –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–±–æ—Ä–æ–∫ –∑–∞–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –∏ —Å—á–∏—Ç—ã–≤–∞–π—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ `${{ secrets.NAME }}`.

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ —á–∞—Ç:
```
/download https://youtu.be/xxxx
```
–∏–ª–∏
```
/download
https://vm.tiktok.com/xxxx
```

–ë–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —Å—Ç–∞—Ç—É—Å–æ–º, —Å–∫–∞—á–∞–µ—Ç –∏ –ø—Ä–∏—à–ª—ë—Ç –≤–∏–¥–µ–æ. –ï—Å–ª–∏ —Ñ–∞–π–ª > 2 –ì–ë ‚Äî –≤—ã–¥–∞—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–µ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.

- –î–ª—è QA/—Ä–µ–ª–∏–∑-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –µ—Å—Ç—å —á–µ–∫-–ª–∏—Å—Ç `docs/QA.md`, –∞ –∫–ª—é—á–µ–≤—ã–µ –Ω–æ–≤–∏–Ω–∫–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –Ω–∏–∂–µ.

### –ù–æ–≤–æ–µ –≤ —Ä–µ–ª–∏–∑–µ ‚ÄúUX Boost‚Äù

- –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏ –∫–Ω–æ–ø–∫–∏: –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫ (RU/EN) –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π UX –≤ –ª–∏—á–∫–∞—Ö –∏ –≥—Ä—É–ø–ø–∞—Ö.
- –ñ–∏–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å: —Å—Ç–∞—Ç—É—Å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–ø—Ä–æ—Ü–µ–Ω—Ç, —Å–∫–æ—Ä–æ—Å—Ç—å, ETA, –æ–±—ä—ë–º) –±–µ–∑ —Å–ø–∞–º–∞.
- –í—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞/–∞—É–¥–∏–æ: –≤ –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –ø—Ä–µ—Å–µ—Ç–∞–º–∏ (Auto, 720p, 480p, Audio Only) –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.
- –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞—É–¥–∏–æ-—Ä–µ–∂–∏–º: –ø—Ä–∏ –≤—ã–±–æ—Ä–µ `üéß Audio` –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ—Ä–æ–∂–∫—É —á–µ—Ä–µ–∑ `sendAudio` —Å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å—å—é.
- –û–ø—Ü–∏—è ‚ÄúDownload‚Äù –≤ –≥—Ä—É–ø–ø–∞—Ö: –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç –∫–Ω–æ–ø–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ –∂–µ —Å—Ç–∞—Ç—É—Å—ã.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã: `tests/test_quality_ui.py` –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π `tests/test_handlers_downloads.py` –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–µ—Å–µ—Ç—ã, rate-limit, fallback –Ω–∞ `send_document`.
- –¢–∏—Ö–∏–µ —Ç–µ—Å—Ç—ã: suite –æ—Ç–∫–ª—é—á–∞–µ—Ç –±–æ–ª—Ç–ª–∏–≤—ã–µ –ª–æ–≥–∏ yt-dlp –∏ status-—Ö–µ–Ω–¥–ª–µ—Ä–æ–≤, –ø–æ—ç—Ç–æ–º—É CI –≤—ã–≤–æ–¥ —á–∏—â–µ.
### UX-—Ñ–∏—á–∏ –∏ –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞

- –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —è–∑—ã–∫ Telegram-–∫–ª–∏–µ–Ω—Ç–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å—ã/–∫–Ω–æ–ø–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º –∏–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.
- –ü–æ–∫–∞ –≤–∏–¥–µ–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è, —Å—Ç–∞—Ç—É—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: –ø—Ä–æ—Ü–µ–Ω—Ç—ã, —Å–∫–æ—Ä–æ—Å—Ç—å, ETA –∏ –æ–±—ä—ë–º —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –í –ª–∏—á–Ω—ã—Ö —á–∞—Ç–∞—Ö –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –≤—ã–±—Ä–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ: `‚öôÔ∏è Auto`, `HD 720p`, `SD 480p` –∏–ª–∏ `üéß Audio`. –û–ø—Ü–∏—è `Audio` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Ä–æ–∂–∫—É –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–¥–ø–∏—Å—å ¬´–ê—É–¥–∏–æ –¥–æ—Ä–æ–∂–∫–∞‚Ä¶¬ª.
- –ï—Å–ª–∏ –≤—ã–±–æ—Ä –ø—Ä–æ—Å—Ä–æ—á–µ–Ω (–ø–æ —Ç–∞–π–º-–∞—É—Ç—É ~5 –º–∏–Ω—É—Ç), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–µ—Ä–µ—Å–ª–∞—Ç—å —Å—Å—ã–ª–∫—É –µ—â—ë —Ä–∞–∑ ‚Äî –±–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å.

## –î–µ–ø–ª–æ–π

### Docker (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ –æ–±–ª–∞–∫–µ)

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å docker-compose
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ docker-compose
# https://docs.docker.com/get-docker/

# 2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env —Å —Ç–æ–∫–µ–Ω–æ–º
cat > .env << EOF
TELEGRAM_BOT_TOKEN=your_token_here
SENTRY_DSN=https://your-sentry-dsn-here (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
EOF

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d

# 4. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏
docker-compose logs -f bot

# 5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose down
```

#### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é
```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t tg-video-downloader:latest .

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker run -d \
  -e TELEGRAM_BOT_TOKEN="your_token_here" \
  -e LOG_FILE=/app/logs/bot.log \
  -e SENTRY_DSN="https://your-sentry-dsn" \
  -v $(pwd)/logs:/app/logs \
  --restart unless-stopped \
  --name tg_video_bot \
  tg-video-downloader:latest

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs -f tg_video_bot

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker stop tg_video_bot
docker rm tg_video_bot
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ffmpeg –≤ –æ–±—Ä–∞–∑–µ
```bash
docker run --rm tg-video-downloader:latest ffmpeg -version | head -n 1
docker run --rm tg-video-downloader:latest ffprobe -version | head -n 1
```

### Railway / Render
- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- –í –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (Environment) –¥–æ–±–∞–≤—å—Ç–µ TELEGRAM_BOT_TOKEN.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ requirements.txt —Å–æ–¥–µ—Ä–∂–∏—Ç yt-dlp –∏ sentry-sdk.
- Start Command: `python main.py`.

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
- `TELEGRAM_BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ BotFather. –ë–µ–∑ –Ω–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç.
- `DATABASE_URL` ‚Äî DSN –¥–ª—è SQLite/Postgres/Neon. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ—Å—Ç–∞–≤—å—Ç–µ `sqlite:///./data/history.db`, –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —É–∫–∞–∂–∏—Ç–µ `postgresql+psycopg://...`.

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Sentry)
- `LOG_FILE` ‚Äî –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `/app/logs/bot.log` –≤ Docker). –ï—Å–ª–∏ –∑–∞–¥–∞–Ω, –±–æ—Ç –±—É–¥–µ—Ç –ø–∏—Å–∞—Ç—å —Ä–æ—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª.
- `LOG_MAX_BYTES` –∏ `LOG_BACKUP_COUNT` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—Ç–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10MB –∏ 5 —Ñ–∞–π–ª–æ–≤).
- `SENTRY_DSN` ‚Äî –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –±–æ—Ç –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Sentry (—Ç—Ä–µ–±—É–µ—Ç `sentry-sdk` –≤ `requirements.txt`).
- `MAX_GLOBAL_CONCURRENT_DOWNLOADS` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4).
- `MAX_CONCURRENT_PER_USER` ‚Äî —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤ –ª–∏—á–∫–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2).
- `USER_COOLDOWN_SECONDS` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 —Å–µ–∫—É–Ω–¥).
- `CALLBACK_CHAT_COOLDOWN_SECONDS` ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –Ω–∞–∂–∞—Ç–∏—è–º–∏ Download –≤ –æ–¥–Ω–æ–º —á–∞—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3 —Å–µ–∫—É–Ω–¥—ã).
- `CALLBACK_GLOBAL_MAX_CALLS` –∏ `CALLBACK_GLOBAL_WINDOW_SECONDS` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ callback-–∑–∞–ø—É—Å–∫–æ–≤ –≤ —Å–∫–æ–ª—å–∑—è—â–µ–º –æ–∫–Ω–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É).
- `DOWNLOAD_TIMEOUT` ‚Äî —Ç–∞–π–º–∞—É—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1200 = 20 –º–∏–Ω—É—Ç).
- `STRUCTURED_LOGS` ‚Äî –µ—Å–ª–∏ `true`, –≤–∫–ª—é—á–∞–µ—Ç JSON-–ª–æ–≥–∏ (–ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `false`.
- `HEALTHCHECK_ENABLED` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –ª—ë–≥–∫–∏–π HTTP-—Å–µ—Ä–≤–µ—Ä `/health` (—Å—Ç–∞—Ç—É—Å) –∏ `/metrics` (—Å–Ω–∏–º–æ–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–µ—Ç—Ä–∏–∫). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`.
- `HEALTHCHECK_HOST`/`HEALTHCHECK_PORT` ‚Äî –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç healthcheck-—Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.0.0.0:8079`, —Å—Ç–∞–≤—å—Ç–µ –æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç –ø–æ—Ä—Ç–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏).
- `ADMIN_PANEL_HOST`/`ADMIN_PANEL_PORT` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã HTML-–∞–¥–º–∏–Ω–∫–∏. –î–ª—è Railway/Render —Å—Ç–∞–≤—å—Ç–µ `ADMIN_PANEL_HOST=0.0.0.0` –∏ `ADMIN_PANEL_PORT=$PORT`, –∏–Ω–∞—á–µ –ø–∞–Ω–µ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ.
- `ADMIN_PANEL_TOKEN` ‚Äî –æ–±—â–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ï—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω–æ (–∏ –Ω–µ—Ç `ADMIN_PANEL_ADMINS`), –ø–∞–Ω–µ–ª—å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –±–µ–∑ –ø–∞—Ä–æ–ª—è.
- `ADMIN_PANEL_ADMINS` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ `slug|Display:token`. –ü—Ä–∏–º–µ—Ä: `ADMIN_PANEL_ADMINS="oleg|–û–ª–µ–≥:token1,irina|–ò—Ä–∏–Ω–∞:token2"`. –ö–∞–∂–¥—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ª–æ–≥–∏–Ω –∏ –ø–æ–¥–ø–∏—Å—å cookie.
- `ADMIN_PANEL_SESSION_SECRET` / `ADMIN_PANEL_SESSION_TTL_SECONDS` ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Å–µ–∫—Ä–µ—Ç –ø–æ–¥–ø–∏—Å–∏ –∏ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ cookie –≤ –º–Ω–æ–≥–æ–∞–¥–º–∏–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6 —á–∞—Å–æ–≤).
- `VIDEO_CACHE_ENABLED`, `VIDEO_CACHE_DIR`, `VIDEO_CACHE_TTL_SECONDS`, `VIDEO_CACHE_MAX_ITEMS` ‚Äî —É–ø—Ä–∞–≤–ª—è—é—Ç —Ñ–∞–π–ª–æ–≤—ã–º –∫—ç—à–µ–º —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ. –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ —Ç–µ–º –∂–µ —Å—Å—ã–ª–∫–∞–º –±–æ—Ç –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç `yt-dlp`.
- `IG_COOKIES_AUTO_REFRESH`, `IG_LOGIN`, `IG_PASSWORD`, `IG_COOKIES_PATH`, `IG_COOKIES_REFRESH_INTERVAL_HOURS`, `IG_2FA_BACKUP_CODES` ‚Äî –≤–∫–ª—é—á–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ª–æ–≥–∏–Ω –≤ Instagram –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookies, —á—Ç–æ–±—ã yt-dlp –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–≤–µ–∂—É—é –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å–µ—Å—Å–∏—é.
- `MEDIA_SCAN_COMMAND` –∏ `MEDIA_SCAN_TIMEOUT_SECONDS` ‚Äî –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–∫–∞–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `clamscan`). –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ —É–∫–∞–∑–∞–Ω–∞, –±–æ—Ç –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –Ω–µ—ë –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞—Ä–∞–∂—ë–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–ü—Ä–∏–º–µ—Ä** (Railway / Render): –¥–æ–±–∞–≤—å—Ç–µ `SENTRY_DSN` –≤ —Å–µ–∫—Ä–µ—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Environment.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ healthcheck

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `STRUCTURED_LOGS=true`, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ (–ø–æ–¥–æ–π–¥—É—Ç –¥–ª—è Loki/ELK). –ü–æ–ª—è –≤–∫–ª—é—á–∞—é—Ç timestamp, —É—Ä–æ–≤–µ–Ω—å, –∏–º—è –ª–æ–≥–≥–µ—Ä–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.
- –ü—Ä–∏ `HEALTHCHECK_ENABLED=true` –±–æ—Ç –ø–æ–¥–Ω–∏–º–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–π aiohttp-—Å–µ—Ä–≤–µ—Ä —Å –¥–≤—É–º—è endpoint'–∞–º–∏:
  - `GET /health` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ "status": "ok" }`, –ø—Ä–∏–≥–æ–¥–Ω–æ –¥–ª—è k8s liveness/readiness probe.
  - `GET /metrics` ‚Äî –æ—Ç–¥–∞—ë—Ç JSON-—Å–Ω–∏–º–æ–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ –∏ gauge-–º–µ—Ç—Ä–∏–∫ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏).
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `HEALTHCHECK_HOST` –∏ `HEALTHCHECK_PORT`, —á—Ç–æ–±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, `127.0.0.1:9000` –∑–∞ reverse-proxy).

–û–±–∞ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Sentry –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π event loop.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –∏ request context

–ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `STRUCTURED_LOGS=true` –∫–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª—è–º–∏ –∏–∑ request context:

| –ü–æ–ª–µ         | –ó–Ω–∞—á–µ–Ω–∏–µ                                                            |
|--------------|---------------------------------------------------------------------|
| `request_id` | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞/–∑–∞–≥—Ä—É–∑–∫–∏ (–º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö).   |
| `user_id`    | Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–≤—à–µ–≥–æ –∑–∞–≥—Ä—É–∑–∫—É/–∫–æ–ª–±—ç–∫.          |
| `chat_id`    | ID —á–∞—Ç–∞, –≥–¥–µ –ø—Ä–∏—à—ë–ª –∑–∞–ø—Ä–æ—Å (–ª–∏—á–∫–∞, –≥—Ä—É–ø–ø–∞, –∫–∞–Ω–∞–ª).                  |
| `channel`    | –¢–∏–ø —á–∞—Ç–∞ (`private`, `group`, `supergroup`).                         |
| `source`     | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (`direct`, `group`, `callback`).                         |
| `platform`   | –û–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Å—Å—ã–ª–∫–∏ (YouTube, TikTok, Instagram, ...).    |

–≠—Ç–æ –∂–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Sentry breadcrumbs, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ID –∑–∞–ø—Ä–æ—Å–∞, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### –ú–µ—Ç—Ä–∏–∫–∏ `/metrics`

Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤–∏–¥–∞:

```json
{
  "timestamp": 1734032400,
  "counters": {"downloads.total": 12, ...},
  "gauges": {"downloads.active": 1, ...}
}
```

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:

| –ò–º—è                              | –¢–∏–ø      | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                                                      |
|----------------------------------|----------|--------------------------------------------------------------------------------------------------|
| `downloads.total`                | counter  | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è (–ø—Ä—è–º—ã—Ö –∏ callback).                                         |
| `downloads.success`              | counter  | –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –≤—ã–¥–∞—á–∏ —Ñ–∞–π–ª–∞.                                                                 |
| `downloads.failure`              | counter  | –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏/–æ—Ç–ø—Ä–∞–≤–∫–∏ (DownloadError, Telegram errors –∏ —Ç.–ø.).                                |
| `downloads.denied`               | counter  | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏/—á–∞—Ç—ã (access control).                                             |
| `downloads.blocked`              | counter  | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (SSRF/unsafe URL).                                                        |
| `downloads.unsupported`          | counter  | –ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏–ª–∏ –ø—É—Å—Ç—ã–µ URL.                                                       |
| `downloads.wait_time_ms_total`   | counter  | –°—É–º–º–∞ –æ–∂–∏–¥–∞–Ω–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–µ–º–∞—Ñ–æ—Ä–∞ (–º—Å). –î–µ–ª–∏—Ç–µ –Ω–∞ `downloads.wait_time_events` –¥–ª—è —Å—Ä–µ–¥–Ω–µ–≥–æ.   |
| `downloads.wait_time_events`     | counter  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞–Ω–∏–π —Å–ª–æ—Ç–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.                                                            |
| `downloads.duration_ms_total`    | counter  | –°–æ–≤–æ–∫—É–ø–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (–º—Å). –î–µ–ª–∏—Ç—å—Å—è –Ω–∞ `downloads.duration_events`.               |
| `downloads.duration_events`      | counter  | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (—É—Å–ø–µ—Ö–∏ + –æ—à–∏–±–∫–∏).                                               |
| `downloads.active`               | gauge    | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–∞—á–∏–≤–∞–Ω–∏–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.                                                     |
| `downloads.pending_tokens`       | gauge    | –°–∫–æ–ª—å–∫–æ callback-—Ç–æ–∫–µ–Ω–æ–≤ –æ–∂–∏–¥–∞–Ω–∏—è –≤ –≥—Ä—É–ø–ø–∞—Ö.                                                     |
| `downloads.queue_in_use`         | gauge    | –ß–∏—Å–ª–æ –∑–∞–Ω—è—Ç—ã—Ö —Å–ª–æ—Ç–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–µ–º–∞—Ñ–æ—Ä–∞.                                                       |
| `downloads.queue_available`      | gauge    | –°–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–µ–º–∞—Ñ–æ—Ä–∞.                                                            |
| `downloads.wait_last_ms`         | gauge    | –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ (–º—Å).                                             |

–ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
curl -s http://127.0.0.1:8080/health | jq
curl -s http://127.0.0.1:8080/metrics | jq
```

–ï—Å–ª–∏ `HEALTHCHECK_HOST=0.0.0.0`, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø—É–±–ª–∏—á–Ω–æ (—á–µ—Ä–µ–∑ firewall –∏–ª–∏ –ø—Ä–æ–∫—Å–∏).

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ yt-dlp

yt-dlp —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è, –¥–æ–±–∞–≤–ª—è—è –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º –∏ –∏—Å–ø—Ä–∞–≤–ª—è—è –æ—à–∏–±–∫–∏. –ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (GitHub Actions)
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ GitHub, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç workflow `.github/workflows/update-ytdlp.yml`, –∫–æ—Ç–æ—Ä—ã–π:
- –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ (–ø–æ —Å—Ä–µ–¥–∞ –≤ 3 —É—Ç—Ä–∞ UTC) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ yt-dlp
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏ —Å–æ–∑–¥–∞—ë—Ç pull request
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–µ—Ä–µ–¥ PR

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ GitHub Actions –≤–∫–ª—é—á–µ–Ω–∞ –≤ –≤–∞—à–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Run workflow" –≤—Ä—É—á–Ω—É—é

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

#### –°–ø–æ—Å–æ–± 1: –ò—Å–ø–æ–ª—å–∑—É—è —Å–∫—Ä–∏–ø—Ç
```bash
python3 update_ytdlp.py
```
–°–∫—Ä–∏–ø—Ç:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é yt-dlp
- –ü–æ–ª—É—á–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∏–∑ PyPI
- –û–±–Ω–æ–≤–∏—Ç, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –°–ø–æ—Å–æ–± 2: –ò—Å–ø–æ–ª—å–∑—É—è Makefile
```bash
make update-ytdlp
```

#### –°–ø–æ—Å–æ–± 3: –ü—Ä—è–º–æ–π pip –∫–æ–º–∞–Ω–¥–∞
```bash
pip install --upgrade yt-dlp
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ Docker
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker, –æ–±—Ä–∞–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é yt-dlp –∏–∑ `requirements.txt`:
```bash
docker build --no-cache -t tg-video-downloader:latest .
docker-compose up -d
```

### –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
–ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
pip install yt-dlp==2023.12.0
```

## –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ cookies Instagram

Instagram –≤—Å—ë —á–∞—â–µ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –¥–∞–∂–µ –∫ –ø—É–±–ª–∏—á–Ω—ã–º —Ä–∏–ª—Å–∞–º. –ß—Ç–æ–±—ã –Ω–µ –≤—ã–≥—Ä—É–∂–∞—Ç—å cookies –≤—Ä—É—á–Ω—É—é, –±–æ—Ç –º–æ–∂–µ—Ç —Å–∞–º –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ñ–∞–π–ª –¥–ª—è yt-dlp.

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Playwright –≤–º–µ—Å—Ç–µ —Å Chromium: `pip install playwright` –∏ `playwright install chromium`. –í Docker –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ `RUN playwright install --with-deps chromium`.
2. –í `.env` —É–∫–∞–∂–∏—Ç–µ:
  ```dotenv
  IG_COOKIES_AUTO_REFRESH=true
  IG_LOGIN=–≤–∞—à_–ª–æ–≥–∏–Ω
  IG_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å
  # –ø–æ –∂–µ–ª–∞–Ω–∏—é: IG_COOKIES_PATH=/app/instagram_cookies.txt
  # –ø–æ –∂–µ–ª–∞–Ω–∏—é: IG_2FA_BACKUP_CODES=code1,code2
  ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è headless Chromium, –≤—ã–ø–æ–ª–Ω–∏—Ç –≤—Ö–æ–¥ –Ω–∞ `instagram.com`, —Å–æ—Ö—Ä–∞–Ω–∏—Ç cookies –≤ `IG_COOKIES_PATH` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø–∏—à–µ—Ç –ø—É—Ç—å –≤ `YTDLP_COOKIES_FILE`.
4. –†–∞–∑ –≤ `IG_COOKIES_REFRESH_INTERVAL_HOURS` —á–∞—Å–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 6) –±–æ—Ç –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –≤—Ö–æ–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ—Ç—É—Ö–∞–Ω–∏—è cookies. –ï—Å–ª–∏ Instagram –∑–∞–ø—Ä–æ—Å–∏—Ç 2FA, –±–æ—Ç –∑–∞–ø–∏—à–µ—Ç —ç—Ç–æ –≤ –ª–æ–≥–∏; –¥–æ–±–∞–≤—å—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä—É—á–Ω–æ–π –ª–æ–≥–∏–Ω, —á—Ç–æ–±—ã —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å.

–°–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ª–æ–≥–∞—Ö –∏ health-–¥–∞—à–±–æ—Ä–¥–µ –∞–¥–º–∏–Ω–∫–∏ (–ø–æ—Å–ª–µ–¥–Ω–µ–µ —É—Å–ø–µ—à–Ω–æ–µ –≤—Ä–µ–º—è, –æ—à–∏–±–∫–∏, –ø—Ä–∏—á–∏–Ω–∞ –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞).

## –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ

–ß—Ç–æ–±—ã –Ω–µ –∂–¥–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∫—Ä—É–ø–Ω—ã—Ö —Ä–∏–ª—Å–æ–≤, –±–æ—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ MP4 –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö, –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ `VIDEO_CACHE_TTL_SECONDS` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —á–∞—Å).

- –í `.env` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã (`VIDEO_CACHE_ENABLED=true`). –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `VIDEO_CACHE_MAX_ITEMS` –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (`VIDEO_CACHE_DIR=/app/video_cache`).
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ: –±–æ—Ç –∫–æ–ø–∏—Ä—É–µ—Ç —Ñ–∞–π–ª –∏–∑ –∫—ç—à–∞ –≤ –ª–∏—á–Ω—É—é –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram.
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∞ (–≤–∫–ª—é—á—ë–Ω/–≤—ã–∫–ª, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø–∞–¥–∞–Ω–∏–π/–ø—Ä–æ–º–∞—Ö–æ–≤, –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è) –≤–∏–¥–Ω–æ –≤ –±–ª–æ–∫–µ Health –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

–ï—Å–ª–∏ –¥–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, —É–º–µ–Ω—å—à–∏—Ç–µ `VIDEO_CACHE_MAX_ITEMS` –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –∫—ç—à, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ `VIDEO_CACHE_ENABLED=false`.

## CI –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

GitHub Actions workflow `.github/workflows/ci.yml` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º push/pull request –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

- –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (`ruff` —Å –∫—Ä–∏—Ç–∏—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ E/F);
- —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –ø—Ä–æ–≥–æ–Ω `python -m unittest discover -s tests` —á–µ—Ä–µ–∑ `make test`;
- –≤—ã–≥—Ä—É–∑–∫—É `test.log` –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

–õ–æ–∫–∞–ª—å–Ω–æ —Ç–æ—Ç –∂–µ —Å—Ü–µ–Ω–∞—Ä–∏–π –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `make test` –ª–∏–±–æ `python -m unittest`. –°–ª–µ–¥–∏—Ç–µ –∑–∞
–∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å—é `.env` –ø—Ä–∏ –ø—Ä–æ–≥–æ–Ω–µ —Ç–µ—Å—Ç–æ–≤: —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –Ω–æ —Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.

## –†–µ–∂–∏–º—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞:

### 1. Whitelist —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)

–†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:

```bash
export WHITELIST_MODE=true
export ALLOWED_USER_IDS="123456789,987654321,111111111"
python main.py
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Docker:
```yaml
environment:
  WHITELIST_MODE: "true"
  ALLOWED_USER_IDS: "123456789,987654321,111111111"
```

**–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å–≤–æ–π User ID:**
1. –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Sentry –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ ID

### 2. Admin-only —Ä–µ–∂–∏–º (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)

–†–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤–∏–¥–µ–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º:

```bash
export ADMIN_ONLY=true
python main.py
```

–í –≥—Ä—É–ø–ø–∞—Ö/–∫–∞–Ω–∞–ª–∞—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
–î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —á–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ `ADMIN_USER_IDS`.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
```bash
export ADMIN_ONLY=true
export ADMIN_USER_IDS="123456789,987654321"
python main.py
```

### 3. –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–∞ —Ä–µ–∂–∏–º–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
```bash
export WHITELIST_MODE=true
export ALLOWED_USER_IDS="123456789,987654321"
export ADMIN_ONLY=true
export ADMIN_USER_IDS="111111111"
python main.py
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ò –≤ whitelist, –ò –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

### 4. –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

–ï—Å–ª–∏ –æ–±–∞ —Ä–µ–∂–∏–º–∞ –æ—Ç–∫–ª—é—á–µ–Ω—ã (–∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã), –±–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º:
```bash
python main.py
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –±–æ—Ä—å–±–∞ —Å–æ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è–º–∏

- –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å—Å—ã–ª–∫–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ö–µ–º—ã –∏ —Ö–æ—Å—Ç–∞, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å SSRF (–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è `localhost`, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏ –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã).
- Callback –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –≥—Ä—É–ø–ø –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—Ç—Å—è –ø–æ —á–∞—Ç—É (`CALLBACK_CHAT_COOLDOWN_SECONDS`) –∏ –≥–ª–æ–±–∞–ª—å–Ω–æ (`CALLBACK_GLOBAL_MAX_CALLS` –≤ –æ–∫–Ω–µ `CALLBACK_GLOBAL_WINDOW_SECONDS`), –ø–æ—ç—Ç–æ–º—É –µ–¥–∏–Ω–∏—á–Ω—ã–π —á–∞—Ç –Ω–µ —Å–º–æ–∂–µ—Ç ¬´–∑–∞—Ñ–ª—É–¥–∏—Ç—å¬ª –±–æ—Ç.
- –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `MEDIA_SCAN_COMMAND` –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –ø—Ä–æ–≥–æ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–∫–∞–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `clamscan`). –ó–∞—Ä–∞–∂—ë–Ω–Ω—ã–µ –∏–ª–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram.

–≠—Ç–∏ –º–µ—Ä—ã –¥–æ–ø–æ–ª–Ω—è—é—Ç whitelist/admin —Ä–µ–∂–∏–º—ã –∏ –ø–æ–º–æ–≥–∞—é—Ç —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –±–æ—Ç –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–∞–∂–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –≤ –≥—Ä—É–ø–ø–∞—Ö.

## –ò—Å—Ç–æ—Ä–∏—è –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

–ë–æ—Ç –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –≤ SQLite –ë–î –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

### –í–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

–ò—Å—Ç–æ—Ä–∏—è –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –ß—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å:
```bash
export ENABLE_HISTORY=false
python main.py
```

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–°–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º (—É–∫–∞–∑–∞–Ω—ã –≤ `ADMIN_USER_IDS` –∏–ª–∏ –∞–¥–º–∏–Ω–∞–º –≥—Ä—É–ø–ø):

#### `/stats` ‚Äî –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∑–æ–∫ (—É—Å–ø–µ—à–Ω—ã—Ö –∏ –æ—à–∏–±–æ–∫)
- –û–±—â–∏–π –æ–±—ä—ë–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (MB/GB)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### `/top_users` ‚Äî —Ç–æ–ø 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∑–∞–≥—Ä—É–∑–æ–∫:
- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–æ–∫ –∏ –æ—à–∏–±–æ–∫
- –û–±—ä—ë–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

#### `/platform_stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (YouTube, TikTok, Instagram):
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∑–æ–∫
- –û–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

#### `/my_stats` ‚Äî –≤–∞—à–∞ –ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
–î–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—à–∏—Ö –∑–∞–≥—Ä—É–∑–æ–∫
- –û–±—ä—ë–º –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≥—Ä—É–∑–∫–∏

#### `/recent` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –∑–∞–≥—Ä—É–∑–æ–∫
–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º, –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∏ —Ä–∞–∑–º–µ—Ä–æ–º —Ñ–∞–π–ª–∞.

### –í–µ–±-–∞–¥–º–∏–Ω–∫–∞

–ü–æ–º–∏–º–æ Telegram-–∫–æ–º–∞–Ω–¥ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é HTML-–ø–∞–Ω–µ–ª—å —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

1. –í `.env` –≤–∫–ª—é—á–∏—Ç–µ –ø–∞–Ω–µ–ª—å –∏ –∑–∞–¥–∞–π—Ç–µ –∞–¥—Ä–µ—Å:
  ```bash
  ADMIN_PANEL_ENABLED=true
  ADMIN_PANEL_HOST=0.0.0.0
  ADMIN_PANEL_PORT=8090
  ```
2. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
  - **–û–¥–∏–Ω —Ç–æ–∫–µ–Ω.** –ó–∞–¥–∞–π—Ç–µ `ADMIN_PANEL_TOKEN=supersecret` –∏ –¥–µ–ª–∏—Ç–µ—Å—å –∏–º —Å–æ –≤—Å–µ–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏.
  - **–ù–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤.** –ó–∞–¥–∞–π—Ç–µ `ADMIN_PANEL_ADMINS="oleg|–û–ª–µ–≥:token1,irina|–ò—Ä–∏–Ω–∞:token2"`. –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –ø–æ `?token=` –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫—É `X-Admin-Token` –≤—ã–¥–∞—ë—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—É—é cookie, –¥–∞–ª—å—à–µ –ª–æ–≥–∏–Ω –Ω–µ –Ω—É–∂–µ–Ω. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∑–∞–¥–∞–π—Ç–µ `ADMIN_PANEL_SESSION_SECRET` (—Å—Ç—Ä–æ–∫–∞ >= 32 —Å–∏–º–≤–æ–ª–æ–≤) –∏ `ADMIN_PANEL_SESSION_TTL_SECONDS` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `28800`), —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–π.

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –æ–±—ã—á–Ω–æ. –ü—Ä–∏ –ø–æ–¥–Ω—è—Ç–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è —Å–µ—Ä–≤–µ—Ä –Ω–∞ `http://127.0.0.1:8090/admin` (–∏–ª–∏ –≤–∞—à–µ–º —Ö–æ—Å—Ç–µ/–ø–æ—Ä—Ç—É).
4. –í –ø—Ä–æ—Å—Ç–æ–º —Ä–µ–∂–∏–º–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `?token=...` –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Admin-Token`. –í –º–Ω–æ–≥–æ–∞–¥–º–∏–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —Ç–æ–∫–µ–Ω –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, cookie –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –≤—ã–π—Ç–∏ –º–æ–∂–Ω–æ –ø–æ `http://host:port/admin?logout=1`.

> Railway / Render: –≤—ã—Å—Ç–∞–≤—å—Ç–µ `ADMIN_PANEL_HOST=0.0.0.0` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (`ADMIN_PANEL_PORT=$PORT`), —á—Ç–æ–±—ã –ø–∞–Ω–µ–ª—å –±—ã–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Å–Ω–∞—Ä—É–∂–∏.

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è:
- –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–∑–∞–≥—Ä—É–∑–∫–∏, –æ—à–∏–±–∫–∏, –æ–±—â–∏–π –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö);
- —Ç–∞–±–ª–∏—Ü–∞ —á–∞—Ç–æ–≤ —Å –ø–æ–∏—Å–∫–æ–º –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏/–æ–±—ä—ë–º—É/–æ—à–∏–±–∫–∞–º;
- —Ç–∞–±–ª–∏—Ü–∞ —Ç–æ–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
- —Ä–∞–∑–±–∏–≤–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º;
- –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –∑–∞–≥—Ä—É–∑–æ–∫ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏;
- –±–ª–æ–∫ –æ—á–µ—Ä–µ–¥–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π: –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏ –∏ –Ω–∞–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏–π (–æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–±—Ä–æ—Å–∏—Ç—å pending-—Ç–æ–∫–µ–Ω, –æ—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å);
- —Å–≤–µ–∂–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ `LOG_FILE`.
- –º–∏–Ω–∏-–¥–∞—à–±–æ—Ä–¥ healthcheck (—Å—Ç–∞—Ç—É—Å, –∞–ø—Ç–∞–π–º, counters/gauges –∏–∑ `/metrics`).

–§–æ—Ä–º–∞ –≤ —à–∞–ø–∫–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ `chat_id`, –∏—Å–∫–∞—Ç—å —á–∞—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤. –ë–ª–æ–∫ –æ—á–µ—Ä–µ–¥–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å–≤–æ–¥–∫–æ–π: –º–æ–∂–Ω–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å—à–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–ª–∏ –æ—á–∏—Å—Ç–∏—Ç—å pending-–æ—á–µ—Ä–µ–¥—å –ø—Ä—è–º–æ –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞. –ü–∞–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ (`ENABLE_HISTORY=true`). Health-–±–ª–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è, –µ—Å–ª–∏ `HEALTHCHECK_ENABLED=true`. –í –º–Ω–æ–≥–æ–∞–¥–º–∏–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ –≤ —à–∞–ø–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–º—è –≤–æ—à–µ–¥—à–µ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

–ß—Ç–æ–±—ã –±–ª–æ–∫ –æ—à–∏–±–æ–∫ –∑–∞–ø–æ–ª–Ω—è–ª—Å—è, —É–∫–∞–∂–∏—Ç–µ `LOG_FILE` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/app/logs/bot.log` –≤ Docker) –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –ø—Ä–æ—Ü–µ—Å—Å–∞ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∑–∞–ø–∏—Å–∏.

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—É—Å–∫ —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é:**
```bash
export ENABLE_HISTORY=true
export ADMIN_USER_IDS="123456789,987654321"
python main.py
```

**–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏:**
```bash
export ENABLE_HISTORY=false
python main.py
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –¥–Ω–µ–π):**
```bash
export CLEANUP_OLD_RECORDS_DAYS=60
python main.py
```

### VPS (systemd)
–°–æ–∑–¥–∞–π—Ç–µ systemd unit:
```
[Unit]
Description=Telegram Video Downloader Bot
After=network.target

[Service]
User=youruser
WorkingDirectory=/home/youruser/project
Environment=TELEGRAM_BOT_TOKEN=–í–ê–®_TOKEN
Environment=WHITELIST_MODE=false
Environment=ADMIN_ONLY=false
ExecStart=/home/youruser/venv/bin/python /home/youruser/project/main.py
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
```
–ó–∞—Ç–µ–º:
```
sudo systemctl daemon-reload
sudo systemctl enable tgdownloader
sudo systemctl start tgdownloader
sudo journalctl -u tgdownloader -f
```

## –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. **–¢–æ–∫–µ–Ω**: —Ö—Ä–∞–Ω–∏—Ç–µ `TELEGRAM_BOT_TOKEN` –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è, Secret –≤ Railway/Render). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤ git.
2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞**:
   - –ï—Å–ª–∏ –±–æ—Ç –±—É–¥–µ—Ç –≤ –≥—Ä—É–ø–ø–µ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è).
   - –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî —Ä–µ–∞–ª–∏–∑—É–π—Ç–µ –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ user_id –≤ `config.py` –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º.
3. **–õ–æ–≥–∏**: –Ω–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏ –¥–ª–∏–Ω–Ω—ã–µ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ yt-dlp**: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ `yt-dlp`.
5. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏**: –≤—ã —É–∂–µ –æ–≥—Ä–∞–Ω–∏—á–∏–ª–∏ —Ä–∞–∑–º–µ—Ä (2GB) –∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `DOWNLOAD_TIMEOUT_SECONDS`.
6. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏**: –ø–æ–¥—É–º–∞–π—Ç–µ –æ –±—ç–∫–µ–Ω–¥–µ –æ—á–µ—Ä–µ–¥–µ–π (Redis / Celery) –µ—Å–ª–∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π; MVP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π –≤-–ø–∞–º—è—Ç–∏ –ª–∏–º–∏—Ç.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- aiogram>=3.0.0b7,<4.0.0
- aiohttp>=3.9.0
- yt-dlp>=2023.12.0
- python-dotenv>=1.0.0 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
```
/download https://youtu.be/dQw4w9WgXcQ
```

–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç:
```
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: youtube. –ù–∞—á–∏–Ω–∞—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ... ‚è≥
```
(—á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∏–¥–µ–æ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `yt-dlp` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ PATH –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞, –∑–∞–ø—É—Å–∫–∞—é—â–µ–≥–æ –±–æ—Ç–∞.
- –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ –æ—á–µ—Ä–µ–¥—å.
