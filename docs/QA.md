# Manual UX Shakedown

Этот чек-лист покрывает основные пользовательские сценарии новой UX-фичи (локализация, прогресс-статусы, стабильное авто-качество) и помогает быстро прогнать регрессию в Telegram до релиза.

## Предусловия
- Соберите и запустите бота (`python main.py` или `make dev`).
- Имейте под рукой тестового пользователя (личный чат) и группу, где бот является участником и имеет права отправлять сообщения.
- Подготовьте несколько рабочих ссылок (YouTube/TikTok/Instagram) и одну намеренно неподдерживаемую/битую ссылку.
- Включите нужный язык Telegram-клиента (iOS/Android/Desktop: `Settings → Language`).

## Сценарии для личных чатов
1. **RU локаль, авто-качество**
   - Убедитесь, что язык Telegram = русский.
   - Отправьте `/download <youtube_url>`.
   - Проверьте: статус «ждём окно» на русском, затем прогресс с %/скоростью/ETA, финальный success + кнопки.
2. **EN локаль, авто-качество**
   - Смените язык Telegram на English.
   - Повторите тот же тест: все подписи и кнопки должны быть переведены.
3. **Авто-режим без дополнительной клавиатуры**
   - Убедитесь, что бот сразу начинает скачивание после получения ссылки, никаких inline-кнопок не появляется.
   - Проверьте, что подпись сообщения и статусы соответствуют локали пользователя.
4. **Ошибка источника**
   - Отправьте заведомо плохой URL (например, `http://example.invalid`).
   - Бот должен вернуть локализованное `download.unsupported`/`download.source_unavailable` сообщение.

## Сценарии для групп
1. **Групповая кнопка Download**
   - Добавьте бота в группу, отправьте ссылку без команды.
   - Бот отвечает кнопкой «⬇️ Скачать/Download». Нажмите её и убедитесь, что статусные сообщения обновляются для всей группы.
2. **Перегрев по чату**
   - Быстро нажмите кнопку несколько раз или попросите коллегу повторить → бот должен показать `download.chat_rate_limited`.
3. **Глобальный лимит**
   - Имитация: параллельно в личке запустите несколько загрузок, затем нажмите кнопку в группе. При превышении глобального семафора появится `download.global_rate_limited`.
4. **Отправка больших файлов**
   - Если возможно, протестируйте ссылку >2 ГБ (или временно уменьшите лимит в `config.TELEGRAM_MAX_FILE_BYTES`) и убедитесь, что приходит `download.large_file_limit`.

## Дополнительные проверки
- **Callback истёк:** нажмите group download кнопку спустя >10 минут → бот должен сообщить про истёкший токен.
- **SendDocument fallback:** вручную вызовите кейс, когда `sendVideo` кидает `TelegramBadRequest` (можно временно замокать в коде), и убедитесь, что бот отправляет документ и пишет об ошибке в статусе.
- **Health/metrics:** при включённом health-сервере (`HEALTHCHECK_ENABLED=true`) убедитесь, что `/metrics` отражает скачивания/очередь.

Отмечайте галочками сценарии после прогона — это поможет команде видеть, что UX проверен перед выкатыванием релиза.
